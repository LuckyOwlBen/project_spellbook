package services

import (
	"fmt"
	"project_spellbook/cmd/exploits"
	"strconv"

	"github.com/t94j0/nmap"
)

func CheckForExploits(ports []nmap.Port, ipAddress string) {
	for _, port := range ports {
		fmt.Printf("Port: %d, State: %s, Service: %s\n", port.ID, port.State, port.Service)
		switch port.Service {

		case "telnet":
			fmt.Printf("Telnet service found on port %d\n", port.ID)
			exploits.ProbeTelnet(ipAddress)

		case "ftp":
			fmt.Printf("FTP service found on port %d\n", port.ID)
			exploits.ProbeFTP(ipAddress)

		case "smb":
		case "microsoft-ds":
		case "netbios-ssn":
			fmt.Printf("SMB service found on port %d\n", port.ID)
			exploits.ProbeSMB(ipAddress)

		case "redis":
			fmt.Printf("Redis service found on port %d\n", port.ID)
			exploits.ProbeRedis(ipAddress, strconv.Itoa(int(port.ID)))

		case "http":
		case "https":
			fmt.Printf("HTTP service found on port %d\n", port.ID)
			exploits.ProbeHTTP(ipAddress, strconv.Itoa(int(port.ID)))

		default:
			fmt.Printf("No exploits found for port %d\n", port.ID)
		}
	}
}
